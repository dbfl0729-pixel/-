// assets/js/cart.js

// -----------------------------------------------------
// 1. ë°ì´í„° ì •ì˜ (ê³ ê°ë‹˜ì´ ì œê³µí•´ì£¼ì‹  ìµœì‹  ì •ë³´ ë°˜ì˜)
// -----------------------------------------------------

// 1.1. í¬ëŸ¬ìŠ¤íŠ¸ ì˜µì…˜ ë° ì‚¬ì´ì¦ˆë³„ ì¶”ê°€ê¸ˆì•¡ (Rì€ ë³€ê²½ ë¶ˆê°€, ì”¬ì€ Fë§Œ ë¬´ë£Œ ë³€ê²½)
// í¬ë£¨ì•„ìƒ í¬ëŸ¬ìŠ¤íŠ¸ëŠ” ëª¨ë“  ì‚¬ì´ì¦ˆ 6,000ì› ì¶”ê°€ (ë‹¨, R ì‚¬ì´ì¦ˆëŠ” ë³€ê²½ ë¶ˆê°€)
const CRUST_OPTIONS = [
    { value: 'original', name: 'ì˜¤ë¦¬ì§€ë„', desc: 'ì«„ê¹ƒí•˜ê³  ê³ ì†Œí•œ ê¸°ë³¸ì— ì¶©ì‹¤í•œ ë§›', priceL: 0, priceF: 0, priceP: 0, priceR: 0 },
    { value: 'thin', name: 'ì”¬ (Thin)', desc: 'ë°”ì‚­í•œ ì‹ê°. F ì‚¬ì´ì¦ˆ ë¬´ë£Œ ë³€ê²½ ê°€ëŠ¥.', priceL: 0, priceF: 0, priceP: 0, priceR: 0 },
    { value: 'cheeseroll', name: 'ì¹˜ì¦ˆë¡¤', desc: 'ì§­ì¡°ë¦„í•œ ì²´ë‹¤ì¹˜ì¦ˆê°€ ë¿Œë ¤ì§„ í¬ëŸ¬ìŠ¤íŠ¸ ì† ìŠ¤íŠ¸ë§ ì¹˜ì¦ˆì˜ ìœ í˜¹', priceL: 4000, priceF: 5000, priceP: 6000, priceR: 0 },
    { value: 'goldring', name: 'ê³¨ë“œë§', desc: 'ë‹¬ì½¤í•œ ê³ êµ¬ë§ˆ ë¬´ìŠ¤ì™€ ìŠ¤íŠ¸ë§ ì¹˜ì¦ˆì˜ í™˜ìƒì ì¸ ë§Œë‚¨', priceL: 4000, priceF: 5000, priceP: 6000, priceR: 0 },
    { value: 'spicygarliccheeseroll', name: 'ìŠ¤íŒŒì´ì‹œ ê°ˆë¦­ ì¹˜ì¦ˆë¡¤', desc: 'í’ë¶€í•œ ê°ˆë¦­ í–¥ê³¼ íˆ¬ ë¸”ë Œë“œ ì¹˜ì¦ˆ, ë ˆë“œí˜í¼ë¥¼ ì‚¬ìš©í•œ ì§„í•œ í’ë¯¸!', priceL: 4000, priceF: 5000, priceP: 6000, priceR: 0 },
    { value: 'croissant', name: 'í¬ë£¨ì•„ìƒ', desc: 'ê²¹ê²¹ì´ ì‚´ì•„ìˆëŠ” ë°”ì‚­í•¨ ë²„í„°í’ë¯¸ë¡œ ì™„ì„±ëœ ë„ìš° ëê¹Œì§€ ì™„ë²½í•œ ë§›', priceL: 6000, priceF: 6000, priceP: 6000, priceR: 0 },
];

// 1.2. 1+1 ì´ë²¤íŠ¸ê°€ ì ìš©ë˜ëŠ” í”¼ì ID ëª©ë¡ (ìµœì‹  ì •ë³´ ë°˜ì˜: 5, 6, 8, 9, 10, 15, 16ë²ˆ)
const EVENT_PIZZA_IDS = ['P05', 'P06', 'P08', 'P09', 'P10', 'P15', 'P16'];
let onePlusOneCart = []; // 1+1 ì£¼ë¬¸ì„ ìœ„í•œ ì„ì‹œ ì¹´íŠ¸

// 1.3. 25ê°€ì§€ í”¼ì ë©”ë‰´ ë°ì´í„° (ê°€ê²© ë° ì˜µì…˜ íƒ€ì… ëª…ì‹œ)
const PIZZA_MENU = {
    // 1. í”„ë¦¬ë¯¸ì—„ (í¬ë£¨ì•„ìƒ í¬í•¨ ëª¨ë“  ì˜µì…˜ ê°€ëŠ¥)
    'P01': { name: 'ë°”ë² í ìˆë¦½ í¬ëŸ°ì¹˜', prices: { L: 34500, F: 41900 }, desc: 'í•œ íŒ ê°€ë“ ì†Œê°ˆë¹„, ì˜¤ë¦¬ì§€ë„ ì•„ë©”ë¦¬ì¹¸ BBQ! ì¹˜ì¦ˆì™€ ë°”ì‚­í•œ ì‹ê°ê¹Œì§€ ë”í•œ ë¦¬ì–¼ ê³ ê¸° í”¼ì', crustType: 'all' },
    'P02': { name: 'ë©œë¡œìš° ì½˜í¬ë¦¼', prices: { L: 27500, F: 33900, P: 41500 }, desc: 'ë¶€ë“œëŸ¬ìš´ ì˜¥ìˆ˜ìˆ˜í¬ë¦¼ê³¼ ì½˜&íŒŒì¸ì• í”Œì„ ë”í•œ ë‹¬ì½¤í•œ í”¼ì', crustType: 'all' },
    'P03': { name: 'ìŠ¤íƒ€ë¼ì´íŠ¸ ë°”ì§ˆ', prices: { L: 33500, F: 39900, P: 48500 }, desc: 'ì…ì•ˆ ê°€ë“ ë°”ì§ˆì˜ í–¥ê¸‹í•¨ê³¼ ê³ ì†Œí•œ ì¹˜ì¦ˆì˜ í’ë¯¸ê°€ ëŠê»´ì§€ëŠ” íŠ¹ë³„í•œ ë³„ëª¨ì–‘ í”¼ì', crustType: 'none' }, // í¬ëŸ¬ìŠ¤íŠ¸ ì„ íƒ ì—†ìŒ
    'P04': { name: 'ë”ë¸” í•« ì•¤ ìŠ¤íŒŒì´ì‹œ ë©•ì‹œì¹¸', prices: { L: 33500, F: 39900 }, desc: 'ìƒˆë¡œìš´ ë§›ì˜ ìŠ¤íŒŒì´ì‹œ ê°ˆë¦­ ì¹˜ì¦ˆë¡¤ê³¼ í• ë¼í˜ë‡¨ì˜ ë§Œë‚¨ìœ¼ë¡œ ê°•ë ¬í•œ ë§¤ì½¤í•¨ì´ ê°€ë“í•œ í”¼ì', crustType: 'spicygarliccheeseroll' }, // ìŠ¤íŒŒì´ì‹œê°ˆë¦­ì¹˜ì¦ˆë¡¤ë§Œ
    
    // 2. ë² ìŠ¤íŠ¸ & 1+1 (í¬ë£¨ì•„ìƒ í¬í•¨ ëª¨ë“  ì˜µì…˜ ê°€ëŠ¥)
    'P05': { name: 'ìˆ˜í¼ íŒŒíŒŒìŠ¤ (BEST / 1+1)', prices: { R: 19900, L: 28500, F: 33900, P: 42500 }, desc: 'ê°ì¢… ê³ ê¸°ì™€ ì±„ì†Œê°€ ë“¬ë¿ í† í•‘ëœ íŒŒíŒŒì¡´ìŠ¤ì˜ ë² ìŠ¤íŠ¸ í”¼ì', crustType: 'all' },
    'P06': { name: 'ì¡´ìŠ¤ í˜ì´ë²„ë¦¿ (BEST / 1+1)', prices: { L: 29500, F: 34900, P: 45500 }, desc: 'ì´íƒˆë¦¬ì•ˆ ì†Œì‹œì§€, í˜í¼ë¡œë‹ˆì™€ 6ì¢…ì˜ ì¹˜ì¦ˆê°€ ë§Œë“¤ì–´ ë‚´ëŠ” ì§„í•œ í’ë¯¸', crustType: 'all' },
    'P07': { name: 'ì˜¬ë¯¸íŠ¸', prices: { R: 19900, L: 29500, F: 34900, P: 45500 }, desc: 'íŒŒíŒŒì¡´ìŠ¤ì˜ ì—„ì„ ëœ ê³ ê¸°í† í•‘ìœ¼ë¡œ ê½‰ ì±„ìš´ í™˜ìƒì˜ ë¯¸íŠ¸ í”¼ì', crustType: 'all' },
    'P08': { name: 'ìŠ¤íŒŒì´ì‹œ ì¹˜í‚¨ëœì¹˜ (1+1)', prices: { R: 19900, L: 29500, F: 34900, P: 43500 }, desc: 'ì€ì€í•œ í–¥ê³¼ ë§›ì˜ ëœì¹˜ ì†ŒìŠ¤, ê·¸ë¦´ë“œ ì¹˜í‚¨, ìƒí¼í•œ í† ë§ˆí† ì™€ í• ë¼í˜ë‡¨ê°€ í† í•‘ì˜ í”¼ì', crustType: 'all' },
    'P09': { name: 'ì•„ì´ë¦¬ì‰¬ í¬í…Œì´í†  (1+1)', prices: { R: 18900, L: 27500, F: 32900, P: 40500 }, desc: 'ì§„í•œ ê°ˆë¦­ ì†ŒìŠ¤ì™€ ë‹´ë°±í•œ í¬í…Œì´í†  ì²­í¬ì˜ ì¡°í™”', crustType: 'all' },
    'P10': { name: 'ì¹˜í‚¨ ë°”ë² í (1+1)', prices: { R: 18900, L: 27500, F: 32900, P: 40500 }, desc: 'ìƒˆì½¤ë‹¬ì½¤í•œ íƒ€ë°”ìŠ¤ì½” BBQ ì†ŒìŠ¤ì™€ ë‘íˆ¼í•œ ê·¸ë¦´ë“œ ì¹˜í‚¨ì´ ì–´ìš°ëŸ¬ì§„ ì¹˜í‚¨ í”¼ì', crustType: 'all' },

    // 3. SPECIALTY&THIN
    'P11': { name: 'í¬ë¦¬ìŠ¤í”¼ ì¹˜ì¦ˆ í˜í¼ë¡œë‹ˆ í”¼ì', prices: { F: 31900 }, desc: 'ì–‡ì€ ì”¬ë„ìš° ë°”ë‹¥ì— íŒŒë§ˆì‚°+ë¡œë§ˆë…¸ ì¹˜ì¦ˆê°€ ë”í•´ì ¸ ë”ìš± ë°”ì‚­í•¨ê³¼ ì¹˜ì¦ˆì˜ ê³ ì†Œí•œ í’ë¯¸ë¥¼ ëŠë‚„ ìˆ˜ ìˆëŠ” í”¼ì', crustType: 'thin_only' }, // *THì „ìš©*
    'P12': { name: 'í¬ë¦¬ìŠ¤í”¼ ì¹˜ì¦ˆ íŠ¸ë¦¬í”Œ í”¼ì', prices: { F: 33900 }, desc: 'ë°”ì‚­í•œ ì‹ê°ì˜ íˆ¬ì¹˜ì¦ˆ í¬ëŸ¬ìŠ¤íŠ¸ ì—£ì§€ì— ë¶€ë“œëŸ½ê³  ì§„í•œ ë§›ì„ ëŠë‚„ ìˆ˜ ìˆëŠ” ì•Œí”„ë ˆë„ ì†ŒìŠ¤, ì–‘ì†¡ì´ ë²„ì„¯, í–„ì´ 6ê°€ì§€ ì¹˜ì¦ˆì™€ ì¡°í™”ë¥¼ ì´ë£¨ëŠ” í”¼ì', crustType: 'thin_only' }, // *THì „ìš©*
    'P13': { name: 'í–„ ë¨¸ì‰¬ë£¸ ì‹ìŠ¤ ì¹˜ì¦ˆ', prices: { L: 28500, F: 33900, P: 42500 }, desc: 'ì•Œí”„ë ˆë„ ì†ŒìŠ¤, ì–‘ì†¡ì´ ë²„ì„¯, í–„ì´ 6ê°€ì§€ ì¹˜ì¦ˆì™€ ì¡°í™”ë¥¼ ì´ë£¨ëŠ” í”¼ì', crustType: 'all' },
    'P14': { name: 'ìœ„ìŠ¤ì½˜ì‹  ì¹˜ì¦ˆ í¬í…Œì´í† ', prices: { L: 29500, F: 35900, P: 45500 }, desc: 'ë§¥ì•¤ì¹˜ì¦ˆ ë² ì´ìŠ¤ ì†ŒìŠ¤ì— 6ê°€ì§€ ì¹˜ì¦ˆ, í–„, ë² ì´ì»¨, í˜í¼ë¡œë‹ˆ, ë‹´ë°±í•˜ê³  ë‘íˆ¼í•œ ê°ìì²­í¬ì˜ ì¡°í™”', crustType: 'no_thin' }, // ì”¬ ì œì™¸
    'P15': { name: 'ë”ë¸” ì¹˜ì¦ˆë²„ê±° (1+1)', prices: { L: 29500, F: 34900, P: 43500 }, desc: 'ì œìŠ¤í‹° ë²„ê±° ì†ŒìŠ¤ìœ„ì— ë¹„í”„ì™€ ìƒí¼í•œ í† ë§ˆí† , í”¼í´ì´ ì–´ìš°ì§„ í’ë¶€í•œ ë§›ì„ ì¦ê¸¸ ìˆ˜ ìˆëŠ” í”¼ì', crustType: 'all' },
    'P16': { name: 'í”„ë¦¬ë¯¸ì—„ ì§í™”ë¶ˆê³ ê¸° (1+1)', prices: { L: 29500, F: 34900, P: 43500 }, desc: 'ì •í†µ ì§í™” ë¶ˆê³ ê¸°, ì‹ ì„ í•œ ì±„ì†Œ í† í•‘ìœ¼ë¡œ ëˆ„êµ¬ë‚˜ ì¢‹ì•„í• ìˆ˜ ìˆëŠ” íŒŒíŒŒì¡´ìŠ¤ì˜ ìŠ¤í…Œë”” ì…€ëŸ¬ í”¼ì', crustType: 'all' },
    'P17': { name: 'ì‹ìŠ¤ ì¹˜ì¦ˆ', prices: { L: 26500, F: 31900, P: 39500 }, desc: '6ì¢…ì˜ ì¹˜ì¦ˆ ë§›ì„ í’ë¶€í•˜ê²Œ ëŠë‚„ ìˆ˜ ìˆëŠ” ì •í†µ ì¹˜ì¦ˆí”¼ì', crustType: 'all' },
    'P18': { name: 'ìŠ¤íŒŒì´ì‹œ ì´íƒˆë¦¬ì•ˆ', prices: { L: 27500, F: 33900, P: 40500 }, desc: 'ì´íƒˆë¦¬ì•ˆ ì†Œì‹œì§€ì™€ í¬ëŸ¬ì‰¬ë“œ ë ˆë“œí˜í¼ì˜ ë§¤ìš´ë§›ì´ ì–´ìš°ëŸ¬ì§„ í”¼ì', crustType: 'all' },
    'P19': { name: 'ìŠˆë¦¼í”„ ì•Œí”„ë ˆë„', prices: { F: 34900 }, desc: 'ì–‡ê³  ë°”ì‚­í•œ ì”¬ë„ìš° ìœ„ì— ë¶€ë“œëŸ¬ìš´ ì•Œí”„ë ˆë„ ì†ŒìŠ¤ì™€ íƒ±íƒ±í•œ ìƒˆìš°ê°€ ë§Œë“¤ì–´ë‚´ëŠ” í’ë¶€í•œ ë§›ì´ íŠ¹ì§•', crustType: 'thin_only' }, // *THì „ìš©*

    // 4. CLASSIC (í¬ë£¨ì•„ìƒ í¬í•¨ ëª¨ë“  ì˜µì…˜ ê°€ëŠ¥)
    'P20': { name: 'ë§ˆê°€ë¦¬íƒ€', prices: { R: 16900, L: 23500, F: 28900, P: 36500 }, desc: 'ì§„í•œ í† ë§ˆí†  ì†ŒìŠ¤ì™€ ìµœìƒê¸‰ ëª¨ì§œë ë¼ ì¹˜ì¦ˆê°€ í† í•‘ëœ ì¹˜ì¦ˆí”¼ì', crustType: 'all' },
    'P21': { name: 'í˜í¼ë¡œë‹ˆ', prices: { R: 17900, L: 25500, F: 30900, P: 38500 }, desc: 'ì«„ê¹ƒì«„ê¹ƒ ì§­ì¡°ë¦„í•œ í˜í¼ë¡œë‹ˆì™€ ê³ ì†Œí•œ ì¹˜ì¦ˆê°€ í† í•‘ëœ í”¼ì', crustType: 'all' },
    'P22': { name: 'í•˜ì™€ì´ì•ˆ', prices: { R: 17900, L: 26500, F: 32900, P: 39500 }, desc: 'ìƒˆì½¤ë‹¬ì½¤í•œ íŒŒì¸ì• í”Œê³¼ í–„, ì«€ë“í•œ ëª¨ì§œë ë¼ ì¹˜ì¦ˆ í† í•‘ìœ¼ë¡œ ìƒí¼í•œ ë§›ì´ íŠ¹ì§•', crustType: 'all' },
    'P23': { name: 'ê°€ë“  ìŠ¤í˜ì…œ', prices: { R: 17900, L: 26500, F: 31900, P: 39500 }, desc: 'ì–‘ì†¡ì´, ì²­í”¼ë§, ì˜¬ë¦¬ë¸Œ, ì–‘íŒŒ, í† ë§ˆí† ë“±ì˜ ì‹ ì„ í•œ ì±„ì†Œê°€ í† í•‘ëœ í”¼ì', crustType: 'all' },

    // 5. ë¹„ê±´ (í¬ëŸ¬ìŠ¤íŠ¸ ì„ íƒ ì—†ìŒ)
    'P24': { name: 'ê·¸ë¦°ì‡ ì‹ë¬¼ì„± ë§ˆê°€ë¦¬íƒ€', prices: { L: 26500 }, desc: 'ì „í†µìˆëŠ” SHEESEì‚¬ì˜ ë¹„ê±´ì¹˜ì¦ˆì™€ ì‹ ì„ í•œ í† ë§ˆí†  ì†ŒìŠ¤ì˜ ë§Œë‚¨ìœ¼ë¡œ ê¹”ë”í•œ í’ë¯¸', crustType: 'none', note: 'R(31cm)ì€ L ì‚¬ì´ì¦ˆ ì˜¤íƒ€ë¡œ ê°„ì£¼í•˜ì—¬ Lë¡œ í†µì¼' }, // R(31cm)
    'P25': { name: 'ê·¸ë¦°ì‡ ì‹ë¬¼ì„± ê°€ë“ ìŠ¤í˜ì…œ', prices: { L: 29500 }, desc: 'ë¹„ê±´ì¹˜ì¦ˆì™€ ì‹ ì„ í•œ ì±„ì†Œê°€ ì–´ìš°ëŸ¬ì§„ ì²˜ìŒ ë§›ë³´ëŠ” ì›°ë¹™ ì±„ì‹ í”¼ì', crustType: 'none', note: 'R(31cm)ì€ L ì‚¬ì´ì¦ˆ ì˜¤íƒ€ë¡œ ê°„ì£¼í•˜ì—¬ Lë¡œ í†µì¼' } // R(31cm)
};


// -----------------------------------------------------
// 2. í•µì‹¬ ë¡œì§ í•¨ìˆ˜ë“¤
// -----------------------------------------------------

// ê°€ê²© í¬ë§· í•¨ìˆ˜
const formatPrice = (price) => price.toLocaleString('ko-KR');

// í¬ëŸ¬ìŠ¤íŠ¸ ì¶”ê°€ ê¸ˆì•¡ ê³„ì‚° í•¨ìˆ˜
const getCrustExtraPrice = (pizzaId, size, crustValue) => {
    const crust = CRUST_OPTIONS.find(c => c.value === crustValue);
    if (!crust) return 0;
    
    // R ì‚¬ì´ì¦ˆëŠ” ë¬´ì¡°ê±´ 0ì›
    if (size === 'R') return 0;

    // ì”¬ í¬ëŸ¬ìŠ¤íŠ¸ëŠ” F ì‚¬ì´ì¦ˆë§Œ ë¬´ë£Œ ë³€ê²½, ë‚˜ë¨¸ì§€ëŠ” 0ì›
    if (crustValue === 'thin') {
        return 0; // ì”¬ì€ Fë“  Lì´ë“  ì¶”ê°€ê¸ˆì´ ì—†ìœ¼ë¯€ë¡œ 0ì›
    }
    
    // ì¼ë°˜ ì¶”ê°€ê¸ˆ í¬ëŸ¬ìŠ¤íŠ¸ (ì¹˜ì¦ˆë¡¤, ê³¨ë“œë§, ìŠ¤íŒŒì´ì‹œ, í¬ë£¨ì•„ìƒ)
    const sizeCode = size === 'L' ? 'L' : size === 'F' ? 'F' : size === 'P' ? 'P' : null;
    if (sizeCode && crust[`price${sizeCode}`] !== undefined) {
        return crust[`price${sizeCode}`];
    }
    return 0;
};

// í˜„ì¬ ì„ íƒëœ ì˜µì…˜ ê¸°ë°˜ìœ¼ë¡œ ê°€ê²©ì„ ì—…ë°ì´íŠ¸í•˜ëŠ” í•¨ìˆ˜
const updatePrice = (pizzaId) => {
    const pizzaData = PIZZA_MENU[pizzaId];
    if (!pizzaData) return;

    const sizeSelect = document.getElementById(`size-${pizzaId}`);
    const crustSelect = document.getElementById(`crust-${pizzaId}`);
    const priceSpan = document.getElementById(`total-price-${pizzaId}`);
    const crustAddText = document.getElementById(`crust-add-text-${pizzaId}`);
    
    if (!sizeSelect || !crustSelect || !priceSpan || !crustAddText) {
        console.error(`ID ì—ëŸ¬: ${pizzaId}ì˜ ìš”ì†Œê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        return;
    }

    const selectedSize = sizeSelect.value;
    const selectedCrust = crustSelect.value;

    const basePrice = pizzaData.prices[selectedSize] || 0;
    let crustExtraPrice = getCrustExtraPrice(pizzaId, selectedSize, selectedCrust);
    
    // í¬ëŸ¬ìŠ¤íŠ¸ ì¶”ê°€ê¸ˆ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
    if (crustExtraPrice > 0) {
        crustAddText.textContent = `(í¬ëŸ¬ìŠ¤íŠ¸ ì¶”ê°€ê¸ˆ: +${formatPrice(crustExtraPrice)}ì›)`;
        crustAddText.style.color = '#d9534f'; // ë¹¨ê°„ìƒ‰ ê°•ì¡°
    } else if (selectedCrust === 'thin' && selectedSize === 'F') {
        crustAddText.textContent = `(ì”¬ í¬ëŸ¬ìŠ¤íŠ¸ - F ì‚¬ì´ì¦ˆ ë¬´ë£Œ ë³€ê²½)`;
        crustAddText.style.color = '#46b8da'; // íŒŒë€ìƒ‰ ì •ë³´
    } else {
        crustAddText.textContent = '';
    }

    const totalPrice = basePrice + crustExtraPrice;
    priceSpan.textContent = formatPrice(totalPrice);
};


// ì‚¬ì´ì¦ˆ ì˜µì…˜ì„ ë™ì ìœ¼ë¡œ ìƒì„±í•˜ëŠ” í•¨ìˆ˜
const populateSizeOptions = (pizzaId, prices) => {
    const select = document.getElementById(`size-${pizzaId}`);
    if (!select) return;

    // 1+1 í–‰ì‚¬ í”¼ìëŠ” L ì‚¬ì´ì¦ˆë§Œ ì„ íƒ ê°€ëŠ¥í•˜ë„ë¡ ì²˜ë¦¬ (HTMLì—ì„œ ì˜µì…˜ ì œí•œ)
    if (EVENT_PIZZA_IDS.includes(pizzaId) && select.classList.contains('one-plus-one-size')) {
        // ì´ë¯¸ HTMLì—ì„œ Lë§Œ ì˜µì…˜ìœ¼ë¡œ ë“¤ì–´ìˆë‹¤ê³  ê°€ì •í•˜ê³  ë„˜ì–´ê°
        return;
    }
    
    // ì¼ë°˜ í”¼ì ì‚¬ì´ì¦ˆ ì˜µì…˜ ìƒì„±
    Object.entries(prices).forEach(([size, price]) => {
        const option = document.createElement('option');
        option.value = size;
        option.textContent = `${size} (${size === 'R' ? '23cm' : size === 'L' ? '31cm' : size === 'F' ? '36cm' : '41cm'}) - ${formatPrice(price)}ì›`;
        select.appendChild(option);
    });
};

// í¬ëŸ¬ìŠ¤íŠ¸ ì˜µì…˜ì„ ë™ì ìœ¼ë¡œ ìƒì„±í•˜ëŠ” í•¨ìˆ˜
const populateCrustOptions = (pizzaId, crustType) => {
    const select = document.getElementById(`crust-${pizzaId}`);
    if (!select) return;

    // í¬ëŸ¬ìŠ¤íŠ¸ ì„ íƒì´ ì—†ëŠ” ê²½ìš° (P03, P24, P25)
    if (crustType === 'none') {
        select.style.display = 'none';
        select.insertAdjacentHTML('beforebegin', '<p style="font-size: 0.9em; color: #555;">(í¬ëŸ¬ìŠ¤íŠ¸ ë³€ê²½ ë¶ˆê°€)</p>');
        return;
    }
    
    // ê¸°ë³¸ ì˜µì…˜ (ì˜¤ë¦¬ì§€ë„ì€ ëª¨ë“  í”¼ìì— í¬í•¨)
    let availableCrusts = ['original'];

    if (crustType === 'all') {
        availableCrusts = CRUST_OPTIONS.map(c => c.value);
    } else if (crustType === 'no_thin') {
        availableCrusts = CRUST_OPTIONS.filter(c => c.value !== 'thin').map(c => c.value);
    } else if (crustType === 'spicygarliccheeseroll') {
        availableCrusts = ['original', 'spicygarliccheeseroll'];
    } else if (crustType === 'thin_only') {
        availableCrusts = ['thin'];
    }

    // ì˜µì…˜ ìƒì„±
    CRUST_OPTIONS.forEach(crust => {
        if (availableCrusts.includes(crust.value)) {
            const option = document.createElement('option');
            option.value = crust.value;
            // ì”¬ í¬ëŸ¬ìŠ¤íŠ¸ëŠ” L, P ì‚¬ì´ì¦ˆ ì„ íƒ ì‹œ ì˜µì…˜ì—ì„œ ì œì™¸ (Fë§Œ ë¬´ë£Œ ë³€ê²½ìœ¼ë¡œ ë¡œì§ ë‹¨ìˆœí™”)
            if (crust.value === 'thin' && PIZZA_MENU[pizzaId].prices.L && !PIZZA_MENU[pizzaId].prices.F) {
                 // ì”¬ í¬ëŸ¬ìŠ¤íŠ¸ ì˜µì…˜ì„ ìƒì„±í•˜ì§€ ì•Šê±°ë‚˜, disabled ì²˜ë¦¬ (í˜„ì¬ ë¡œì§ì—ì„œëŠ” ì¼ë‹¨ ëª¨ë‘ í‘œì‹œ í›„ ê°€ê²© ë¡œì§ìœ¼ë¡œ ì œì–´)
            }
            
            let priceText = '';
            if (crust.value !== 'original' && crust.value !== 'thin') {
                priceText = `(+${formatPrice(crust.priceL)}~${formatPrice(crust.priceP)}ì›)`;
            } else if (crust.value === 'thin') {
                priceText = '(F ì‚¬ì´ì¦ˆ ë¬´ë£Œ ë³€ê²½)';
            }
            
            option.textContent = `${crust.name.split('(')[0].trim()} ${priceText}`;
            select.appendChild(option);
        }
    });

    // thin_only í”¼ìëŠ” ì”¬ì„ ê¸°ë³¸ìœ¼ë¡œ ì„ íƒ
    if (crustType === 'thin_only') {
        select.value = 'thin';
    } else {
         select.value = 'original'; // ê¸°ë³¸ê°’ ì˜¤ë¦¬ì§€ë„
    }
};

// 1+1 ì¥ë°”êµ¬ë‹ˆì— ì•„ì´í…œ ì¶”ê°€ ë° ì²˜ë¦¬
const handleOnePlusOneAdd = (pizzaId) => {
    const pizzaData = PIZZA_MENU[pizzaId];
    const crustSelect = document.getElementById(`crust-${pizzaId}`);
    
    // 1. L ì‚¬ì´ì¦ˆ ê°•ì œ í™•ì¸ (1+1ì€ L ì‚¬ì´ì¦ˆë§Œ í•´ë‹¹)
    const sizeSelect = document.getElementById(`size-${pizzaId}`);
    if (sizeSelect.value !== 'L') {
        alert('âš ï¸ 1+1 ì´ë²¤íŠ¸ëŠ” L ì‚¬ì´ì¦ˆ í”¼ìë§Œ ì£¼ë¬¸ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì‚¬ì´ì¦ˆë¥¼ Lë¡œ ë³€ê²½í•´ ì£¼ì„¸ìš”.');
        return;
    }
    
    // 2. í¬ëŸ¬ìŠ¤íŠ¸ ë°ì´í„° ì¶”ì¶œ
    const selectedCrustValue = crustSelect.value;
    const crustOption = CRUST_OPTIONS.find(c => c.value === selectedCrustValue);
    const crustExtraPrice = getCrustExtraPrice(pizzaId, 'L', selectedCrustValue);

    const itemData = {
        id: pizzaId,
        name: pizzaData.name,
        basePrice: pizzaData.prices.L,
        crustValue: selectedCrustValue,
        crustName: crustOption.name,
        crustExtraPrice: crustExtraPrice,
    };

    // 3. ì¤‘ë³µ í™•ì¸
    if (onePlusOneCart.some(p => p.id === itemData.id)) {
        alert('âš ï¸ ì´ë¯¸ ì„ íƒëœ í”¼ìì…ë‹ˆë‹¤. ë‹¤ë¥¸ í”¼ìë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.');
        return;
    }

    // 4. ì¹´íŠ¸ì— ì¶”ê°€ ë° ì²˜ë¦¬
    onePlusOneCart.push(itemData);

    if (onePlusOneCart.length === 1) {
        alert(`âœ… íŒŒíŒŒí”„ë¼ì´ë°ì´ 1+1 - ì²« ë²ˆì§¸ í”¼ì (${itemData.name}) ì„ íƒ ì™„ë£Œ! ì´ì œ ë‘ ë²ˆì§¸ í”¼ìë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.`);
        // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
        document.querySelector(`.pizza-card[data-id="${pizzaId}"] button`).textContent = 'âœ… ì„ íƒë¨ (ë‘ ë²ˆì§¸ ì„ íƒ ëŒ€ê¸°)';
        
    } else if (onePlusOneCart.length === 2) {
        // ìµœì¢… ê³„ì‚°
        const [p1, p2] = onePlusOneCart;
        const maxBasePrice = Math.max(p1.basePrice, p2.basePrice);
        const totalCrustExtraPrice = p1.crustExtraPrice + p2.crustExtraPrice;
        const finalPrice = maxBasePrice + totalCrustExtraPrice;

        alert(`
            ğŸ‰ íŒŒíŒŒí”„ë¼ì´ë°ì´ 1+1 ì£¼ë¬¸ ì™„ë£Œ (í¬ì¥ ì „ìš©, ë°°ë‹¬ ë¶ˆê°€)

            ğŸ• ì²« ë²ˆì§¸ í”¼ì: ${p1.name} (L / ${p1.crustName} +${formatPrice(p1.crustExtraPrice)}ì›)
            ğŸ• ë‘ ë²ˆì§¸ í”¼ì: ${p2.name} (L / ${p2.crustName} +${formatPrice(p2.crustExtraPrice)}ì›)
            
            ğŸ’° ìµœì¢… 1+1 ê°€ê²©: ${formatPrice(finalPrice)}ì› 
            (ë¹„ì‹¼ í”¼ì ê°€ê²© ${formatPrice(maxBasePrice)}ì› + í¬ëŸ¬ìŠ¤íŠ¸ ì¶”ê°€ê¸ˆ í•©ê³„ ${formatPrice(totalCrustExtraPrice)}ì›)
        `);
        
        // ì£¼ë¬¸ ì™„ë£Œ í›„ ì¹´íŠ¸ ë° ë²„íŠ¼ ì´ˆê¸°í™”
        onePlusOneCart = [];
        document.querySelectorAll('.one-plus-one-btn').forEach(btn => {
            btn.textContent = 'ğŸ‰ 1+1 ë‹´ê¸°';
        });
    }
};


// ë©”ë‰´ ì´ˆê¸°í™” í•¨ìˆ˜
const initializeMenu = () => {
    // 1. ëª¨ë“  í”¼ì ì¹´ë“œì— ëŒ€í•´ ì˜µì…˜ ìƒì„± ë° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
    document.querySelectorAll('.pizza-card.menu-item').forEach(card => {
        const pizzaId = card.getAttribute('data-id');
        const pizzaData = PIZZA_MENU[pizzaId];

        if (!pizzaData) return; // ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš° ìŠ¤í‚µ

        // ì‚¬ì´ì¦ˆ/í¬ëŸ¬ìŠ¤íŠ¸ ì˜µì…˜ ìƒì„±
        populateSizeOptions(pizzaId, pizzaData.prices);
        populateCrustOptions(pizzaId, pizzaData.crustType);
        
        const sizeSelect = document.getElementById(`size-${pizzaId}`);
        const crustSelect = document.getElementById(`crust-${pizzaId}`);
        const addButton = card.querySelector('.add-to-bill-btn');

        // 2. ê°€ê²© ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ ì—°ê²°
        if (sizeSelect) {
            sizeSelect.addEventListener('change', () => { updatePrice(pizzaId); });
        }
        if (crustSelect) {
            crustSelect.addEventListener('change', () => { updatePrice(pizzaId); });
        }

        // 3. ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì—°ê²°
        if (addButton) {
             if (addButton.classList.contains('one-plus-one-btn')) {
                // 1+1 ì´ë²¤íŠ¸ ë²„íŠ¼
                addButton.addEventListener('click', (e) => {
                    e.preventDefault();
                    handleOnePlusOneAdd(pizzaId);
                });
            } else {
                // ì¼ë°˜ ì£¼ë¬¸ ë²„íŠ¼
                addButton.addEventListener('click', (e) => {
                    e.preventDefault();
                    const selectedSize = sizeSelect ? sizeSelect.value : Object.keys(pizzaData.prices)[0];
                    const selectedCrustOption = crustSelect ? crustSelect.options[crustSelect.selectedIndex] : { textContent: 'í•´ë‹¹ì—†ìŒ', value: 'original' };
                    const finalPrice = document.getElementById(`total-price-${pizzaId}`).textContent.replace(/,/g, '');
                    const pizzaName = card.getAttribute('data-name');
                    
                    alert(`
                        ğŸ§¾ ê³„ì‚°ì„œì— ì¶”ê°€ë¨:
                        - ë©”ë‰´: ${pizzaName}
                        - ì‚¬ì´ì¦ˆ: ${selectedSize}
                        - í¬ëŸ¬ìŠ¤íŠ¸: ${selectedCrustOption.textContent.split('(')[0].trim()}
                        - ìµœì¢… ê°€ê²©: ${finalPrice}ì›
                        
                        (âš ï¸ ì‹¤ì œ ê³„ì‚°ì„œ í˜ì´ì§€ë¡œì˜ ë°ì´í„° ì „ì†¡ ë¡œì§ì´ í•„ìš”í•©ë‹ˆë‹¤.)
                    `);
                });
            }
        }

        // 4. ì´ˆê¸° ê°€ê²© ì„¤ì •
        updatePrice(pizzaId);
    });
};

// DOM ë¡œë“œ í›„ ë©”ë‰´ ì´ˆê¸°í™” í•¨ìˆ˜ ì‹¤í–‰
document.addEventListener('DOMContentLoaded', initializeMenu);